---
title: "On Rectangular Map Approximations"
author: "Christian Panse"
date: "`r Sys.Date()`"
bibliography:
  - recmap.bib
csl: ieee.csl
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{recmap primer}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

This package contains a C++ implementation of the recmap algorithm 
[[@recmap]](http://dx.doi.org/10.1109/INFVIS.2004.57).
The input contains for each map region:

- a tuple of (x, y) values corresponding to the (longitude, latitude) position 
- a map ratio, 
- and a statistical value z.

The (x, y) coordinates represents the center of the minimal bounding boxes (MBB), 
the ratio the longitude / latitude 
ratios, and the  statistical values define the desired 
area of each map region. 

The output is a rectangular cartogram where the map regions are:

- non overlapping, 
- connected, 
- ratio and area of each rectangle corresponds to the desired areas.
- rectangles are parallel to the axes

The construction heuristic places the rectangles in a way that important 
spatial constraints, in particular

- the topology of the pseudo dual graph,
- the relative position of MBB centers, 
- and the ratios of each input map regions.

are tried to be preserved


```{r fig.width=7, fig.retina=2, fig.align='center', fig.cap="Rectangular Cartogram of the U.S. election 2004; The area corresponds to the number of electors. The graphic was computed by using the original implementation of the construction heuristic RecMap MP2 introduced in [@recmap]."}

library(recmap)
op<-par(mar=c(0,0,0,0), bg='black')
recmap:::.draw_recmap_us_state_ev()
par(op)
```


# Example Data
```{r}
recmap:::.checker_board(2)
```

```{r fig.width=5, fig.height=5, fig.align='center'}


op<-par(mar=c(0,0,0,0), 
        mfrow=c(2,2), 
        bg='white')

res <- lapply(c(2, 4, 8, 64), function(n){plot.recmapFrame(recmap:::.checker_board(n))})

par(op)
```

# The Algorithm

## Desired Areas

The desired area $\tilde{A_j}$ of a map region  $r_j$ is defined as
$\tilde{A_j}= z_j \cdot \frac {\sum_{i=1}^{k}A(r_j)} {\sum_{j=1}^{k} z_{j}}$ (see also [@cartodraw]). 

## Compute Pseudo Dual Graph (PD)

## Determine the Core Region

## Place rectangles along DFS Skeleton of PD

## Objective Functions

### Topology 

### Relative Position

## Evaluation 

### Proof of Concept

```{r}
chess_board <- recmap:::.checker_board(8)
(chess_board.area <- sum(chess_board$dx * chess_board$dy * 4))

chess_board_cartogram <- recmap:::recmap(chess_board)

table(chess_board_cartogram$dx * chess_board_cartogram$dy * 4)

(chess_board_cartogram.area <- sum(chess_board_cartogram$dx * chess_board_cartogram$dy * 4))

chess_board_cartogram.area == chess_board.area
```

# Benchmark


#References

